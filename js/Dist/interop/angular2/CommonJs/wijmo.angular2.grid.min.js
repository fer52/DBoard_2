/*
    *
    * Wijmo Library 5.20181.436
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,o,i){var r,l=arguments.length,n=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(l<3?r(n):l>3?r(t,o,n):r(t,o))||n);return l>3&&n&&Object.defineProperty(t,o,n),n},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),core_2=require("@angular/core"),core_3=require("@angular/core"),common_1=require("@angular/common"),forms_1=require("@angular/forms"),wijmo_angular2_directiveBase_1=require("wijmo/wijmo.angular2.directiveBase");exports.wjFlexGridMeta={selector:"wj-flex-grid",template:"<div><ng-content></ng-content></div>",inputs:["wjModelProperty","isDisabled","newRowAtTop","allowAddNew","allowDelete","allowDragging","allowMerging","allowResizing","allowSorting","quickAutoSize","autoScroll","autoSizeMode","autoGenerateColumns","childItemsPath","groupHeaderFormat","headersVisibility","showSelectedHeaders","showMarquee","itemFormatter","isReadOnly","imeEnabled","mergeManager","selectionMode","showGroups","showSort","showDropDown","showAlternatingRows","showErrors","validateEdits","treeIndent","itemsSource","autoClipboard","frozenRows","frozenColumns","cloneFrozenCells","deferResizing","sortRowIndex","stickyHeaders","preserveSelectedState","preserveOutlineState","keyActionTab","keyActionEnter","rowHeaderPath","virtualizationThreshold"],outputs:["initialized","gotFocusNg: gotFocus","lostFocusNg: lostFocus","beginningEditNg: beginningEdit","cellEditEndedNg: cellEditEnded","cellEditEndingNg: cellEditEnding","prepareCellForEditNg: prepareCellForEdit","formatItemNg: formatItem","resizingColumnNg: resizingColumn","resizedColumnNg: resizedColumn","autoSizingColumnNg: autoSizingColumn","autoSizedColumnNg: autoSizedColumn","draggingColumnNg: draggingColumn","draggingColumnOverNg: draggingColumnOver","draggedColumnNg: draggedColumn","sortingColumnNg: sortingColumn","sortedColumnNg: sortedColumn","resizingRowNg: resizingRow","resizedRowNg: resizedRow","autoSizingRowNg: autoSizingRow","autoSizedRowNg: autoSizedRow","draggingRowNg: draggingRow","draggingRowOverNg: draggingRowOver","draggedRowNg: draggedRow","deletingRowNg: deletingRow","deletedRowNg: deletedRow","loadingRowsNg: loadingRows","loadedRowsNg: loadedRows","rowEditStartingNg: rowEditStarting","rowEditStartedNg: rowEditStarted","rowEditEndingNg: rowEditEnding","rowEditEndedNg: rowEditEnded","rowAddedNg: rowAdded","groupCollapsedChangedNg: groupCollapsedChanged","groupCollapsedChangingNg: groupCollapsedChanging","itemsSourceChangedNg: itemsSourceChanged","selectionChangingNg: selectionChanging","selectionChangedNg: selectionChanged","scrollPositionChangedNg: scrollPositionChanged","updatingViewNg: updatingView","updatedViewNg: updatedView","updatingLayoutNg: updatingLayout","updatedLayoutNg: updatedLayout","pastingNg: pasting","pastedNg: pasted","pastingCellNg: pastingCell","pastedCellNg: pastedCell","copyingNg: copying","copiedNg: copied"],providers:[{provide:forms_1.NG_VALUE_ACCESSOR,useFactory:wijmo_angular2_directiveBase_1.WjValueAccessorFactory,multi:!0,deps:["WjComponent"]}]};var WjFlexGrid=function(e){function t(t,o,i,r){var l=e.call(this,wijmo_angular2_directiveBase_1.WjDirectiveBehavior.getHostElement(t,o))||this;l.isInitialized=!1;l._wjBehaviour=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.attach(l,t,o,i);return new DirectiveCellFactory(l,r),l.deferUpdate(function(){if(l.rows.defaultSize<10){var e=l.hostElement,t=getComputedStyle(e),o=getComputedStyle(document.body),i=2*parseInt(t.fontSize&&wijmo.contains(document.body,e)?t.fontSize:o.fontSize);l.rows.defaultSize=i,l.columns.defaultSize=4*i,l.columnHeaders.rows.defaultSize=i,l.rowHeaders.columns.defaultSize=Math.round(1.25*i)}}),l.created(),l}return __extends(t,e),o=t,t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t.prototype.addEventListener=function(t,o,i,r){var l=this;void 0===r&&(r=!1);var n=wijmo_angular2_directiveBase_1.WjDirectiveBehavior,a=n.ngZone;a&&n.outsideZoneEvents[o]?a.runOutsideAngular(function(){e.prototype.addEventListener.call(l,t,o,i,r)}):e.prototype.addEventListener.call(this,t,o,i,r)},t.meta={outputs:exports.wjFlexGridMeta.outputs},t=o=__decorate([core_1.Component({selector:exports.wjFlexGridMeta.selector,template:exports.wjFlexGridMeta.template,inputs:exports.wjFlexGridMeta.inputs,outputs:exports.wjFlexGridMeta.outputs,providers:[{provide:"WjComponent",useExisting:core_2.forwardRef(function(){return o})}].concat(exports.wjFlexGridMeta.providers)}),__param(0,core_3.Inject(core_2.ElementRef)),__param(1,core_3.Inject(core_2.Injector)),__param(2,core_3.Inject("WjComponent")),__param(2,core_3.SkipSelf()),__param(2,core_2.Optional()),__param(3,core_3.Inject(core_3.ChangeDetectorRef))],t);var o}(wijmo.grid.FlexGrid);exports.WjFlexGrid=WjFlexGrid,exports.wjFlexGridColumnMeta={selector:"wj-flex-grid-column",template:"<div><ng-content></ng-content></div>",inputs:["asyncBindings","wjProperty","name","dataMap","dataType","binding","sortMemberPath","format","header","width","maxLength","minWidth","maxWidth","align","allowDragging","allowSorting","allowResizing","allowMerging","aggregate","isReadOnly","cssClass","isContentHtml","isSelected","visible","wordWrap","multiLine","mask","inputType","isRequired","showDropDown","dropDownCssClass","quickAutoSize"],outputs:["initialized","isSelectedChangePC: isSelectedChange"],providers:[]};var WjFlexGridColumn=function(e){function t(t,o,i){var r=e.call(this)||this;r.isInitialized=!1,r.wjProperty="columns";var l=(r._wjBehaviour=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.attach(r,t,o,i)).parentBehavior.directive;return l.autoGenerateColumns&&(l.autoGenerateColumns=!1,l.columns.clear()),r.created(),r}return __extends(t,e),o=t,t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t.meta={outputs:exports.wjFlexGridColumnMeta.outputs,changeEvents:{"grid.selectionChanged":["isSelected"]}},t=o=__decorate([core_1.Component({selector:exports.wjFlexGridColumnMeta.selector,template:exports.wjFlexGridColumnMeta.template,inputs:exports.wjFlexGridColumnMeta.inputs,outputs:exports.wjFlexGridColumnMeta.outputs,providers:[{provide:"WjComponent",useExisting:core_2.forwardRef(function(){return o})}].concat(exports.wjFlexGridColumnMeta.providers)}),__param(0,core_3.Inject(core_2.ElementRef)),__param(1,core_3.Inject(core_2.Injector)),__param(2,core_3.Inject("WjComponent")),__param(2,core_3.SkipSelf()),__param(2,core_2.Optional())],t);var o}(wijmo.grid.Column);exports.WjFlexGridColumn=WjFlexGridColumn;var WjFlexGridCellTemplate=function(){function e(e,t,o,i,r,l,n){this.viewContainerRef=e,this.templateRef=t,this.elRef=o,this.domRenderer=r,this.cdRef=n,this.autoSizeRows=!0,this.forceFullEdit=!0,i instanceof WjFlexGrid?this.grid=i:i instanceof WjFlexGridColumn&&(this.column=i,this.grid=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.getBehavior(i).parentBehavior.directive)}return t=e,e._getTemplContextProp=function(e){return"$__cellTempl"+CellTemplateType[e]},e.prototype.ngOnInit=function(){this.ownerControl=this.column&&this.column.grid===this.grid?this.column:this.grid,this._attachToControl()},e.prototype.ngOnDestroy=function(){this.cellTypeStr&&(this.viewContainerRef.clear(),this.ownerControl[t._getTemplContextProp(this.cellType)]=null,this.grid.invalidate())},e.prototype._instantiateTemplate=function(e,t){return wijmo_angular2_directiveBase_1.WjDirectiveBehavior.instantiateTemplate(e,this.viewContainerRef,this.templateRef,this.domRenderer,!1,t)},e.prototype._attachToControl=function(){if(this.cellTypeStr){var e=this.cellType=wijmo.asEnum(this.cellTypeStr,CellTemplateType),o=this.ownerControl;o[t._getTemplContextProp(e)]=this,o instanceof wijmo.grid.Column&&(e===CellTemplateType.Cell||e===CellTemplateType.ColumnHeader||e===CellTemplateType.ColumnFooter)&&o._setFlag(wijmo.grid.RowColFlags.HasTemplate,!0),this.grid.invalidate()}},e=t=__decorate([core_2.Directive({selector:"[wjFlexGridCellTemplate]",inputs:["wjFlexGridCellTemplate","cellTypeStr: cellType","cellOverflow","valuePaths","autoSizeRows","forceFullEdit"],exportAs:"wjFlexGridCellTemplate",providers:[{provide:"WjComponent",useExisting:core_2.forwardRef(function(){return t})}]}),__param(0,core_3.Inject(core_2.ViewContainerRef)),__param(1,core_3.Inject(core_2.TemplateRef)),__param(1,core_2.Optional()),__param(2,core_3.Inject(core_2.ElementRef)),__param(3,core_3.Inject("WjComponent")),__param(3,core_3.SkipSelf()),__param(3,core_2.Optional()),__param(4,core_3.Inject(core_2.Renderer)),__param(5,core_3.Inject(core_2.Injector)),__param(6,core_3.Inject(core_3.ChangeDetectorRef))],e);var t}();exports.WjFlexGridCellTemplate=WjFlexGridCellTemplate;var CellTemplateType;!function(e){e[e.Cell=0]="Cell",e[e.CellEdit=1]="CellEdit",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.RowHeaderEdit=4]="RowHeaderEdit",e[e.TopLeft=5]="TopLeft",e[e.GroupHeader=6]="GroupHeader",e[e.Group=7]="Group",e[e.NewCellTemplate=8]="NewCellTemplate",e[e.ColumnFooter=9]="ColumnFooter",e[e.BottomLeft=10]="BottomLeft"}(CellTemplateType=exports.CellTemplateType||(exports.CellTemplateType={}));var DirectiveCellFactory=function(e){function t(o,i){var r=e.call(this)||this;if(r._needsCdCheck=!1,r._lastApplyTimeStamp=0,r._noApplyLag=!1,r._startingEditing=!1,r._cellStampCounter=0,r._composing=!1,r.grid=o,r._gridCdRef=i,!t._templateTypes){t._templateTypes=[];for(var l in CellTemplateType)isNaN(l)&&t._templateTypes.push(l)}var n=r;return r._baseCf=o.cellFactory,o.cellFactory=r,r._evtInput=document.createEvent("HTMLEvents"),r._evtInput.initEvent("input",!0,!1),r._evtBlur=document.createEvent("HTMLEvents"),r._evtBlur.initEvent("blur",!1,!1),o.prepareCellForEdit.addHandler(function(e,t){n._noApplyLag=!0}),o.cellEditEnded.addHandler(function(e,t){(t.range.col<0||t.range.col<o.columns.length&&!o.columns[t.range.col][WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType.CellEdit)])&&(n._editChar=null),setTimeout(function(){n._noApplyLag=!1},300)}),o.beginningEdit.addHandler(function(e,t){n._startingEditing=!0}),o.hostElement.addEventListener("keydown",function(e){n._startingEditing=!1},!0),o.hostElement.addEventListener("keypress",function(e){var t=e.charCode>32?String.fromCharCode(e.charCode):null;t&&wijmo.closest(e.target,".wj-flexgrid")===o.hostElement&&(!o.activeEditor||n._startingEditing?n._editChar=t:n._editChar&&(n._editChar+=t))},!0),o.hostElement.addEventListener("compositionstart",function(e){n._composing=!0},!0),o.hostElement.addEventListener("compositionend",function(e){n._composing=!1},!0),o.updatedView.addHandler(function(){r._needsCdCheck&&(r._needsCdCheck=!1,r._gridCdRef.markForCheck())},r),r}return __extends(t,e),t.prototype.updateCell=function(e,o,i,r,l){var n=this;this._cellStampCounter=(this._cellStampCounter+1)%1e7;var a=r[t._cellStampProp]=this._cellStampCounter;r.style.overflow&&(r.style.overflow="");var d=o,s=i;l&&!l.isSingleCell&&(o=l.row,i=l.col);var p,c=this,u=e.grid,m=u.editRange,g=e.rows[o],_=g.dataItem,C=!1,w=!1,f=!1,v=!1;switch(e.cellType){case wijmo.grid.CellType.Cell:if(m&&m.row===o&&m.col===i)p=CellTemplateType.CellEdit,w=f=!0;else if(g instanceof wijmo.grid.GroupRow){var h=!((v=_ instanceof wijmo.collections.CollectionViewGroup)||g.hasChildren);i==e.columns.firstVisibleIndex?p=h?CellTemplateType.Cell:CellTemplateType.GroupHeader:(p=h?CellTemplateType.Cell:CellTemplateType.Group,w=!0)}else g instanceof wijmo.grid._NewRowTemplate?p=CellTemplateType.NewCellTemplate:wijmo.grid.detail&&wijmo.grid.detail.DetailRow&&g instanceof wijmo.grid.detail.DetailRow||(p=CellTemplateType.Cell);break;case wijmo.grid.CellType.ColumnHeader:p=CellTemplateType.ColumnHeader;break;case wijmo.grid.CellType.RowHeader:p=u.collectionView&&u.collectionView.currentEditItem===_?CellTemplateType.RowHeaderEdit:CellTemplateType.RowHeader,C=!0;break;case wijmo.grid.CellType.TopLeft:p=CellTemplateType.TopLeft,C=!0;break;case wijmo.grid.CellType.ColumnFooter:p=CellTemplateType.ColumnFooter,w=!0;break;case wijmo.grid.CellType.BottomLeft:p=CellTemplateType.BottomLeft,C=!0}var y=!1;if(null!=p){var j=v&&p==CellTemplateType.GroupHeader?u.columns.getColumn(_.groupDescription.propertyName):i>=0&&i<e.columns.length?e.columns[i]:null;if(j){var E=WjFlexGridCellTemplate._getTemplContextProp(p),T=(C?u:j)[E];if(T||(p===CellTemplateType.RowHeaderEdit?(p=CellTemplateType.RowHeader,E=WjFlexGridCellTemplate._getTemplContextProp(p),T=u[E]):p!==CellTemplateType.Group&&p!==CellTemplateType.GroupHeader||v||(p=CellTemplateType.Cell,E=WjFlexGridCellTemplate._getTemplContextProp(p),T=j[E])),T){var x;w&&(x=e.getCellData(o,i,!1)),y=!0;var R=r.getAttribute(wijmo.grid.FlexGrid._WJS_MEASURE),S=R&&"true"===R.toLowerCase();f&&this._baseCf.updateCell(e,d,s,r,l,!0);var F,N=r[E]||{},I=N.column!==j||!N.viewRef||N.templateContextProperty!==E||r.firstChild!=N.rootElement,G=f&&this._composing&&u.imeEnabled;if(I){if(f){var H=r.firstElementChild;H&&(G||r.focus(),H.style.display="none")}else r.textContent="";this._doDisposeCell(r);var b={};F=this._setViewRefContext(b,g,j,_,x,T.valuePaths);var z=T._instantiateTemplate(r,b);N.column=j,N.viewRef=z.viewRef,N.rootElement=z.rootElement,N.templateContextProperty=E,r[E]=N}else F=this._setViewRefContext(N.viewRef.context,g,j,_,x,T.valuePaths);if(T.cellOverflow&&(r.style.overflow=T.cellOverflow),S?T.cdRef.detectChanges():T.autoSizeRows&&!G?setTimeout(function(){if(a===r[t._cellStampProp]){var i=r.scrollHeight,d=e.rows,s=l&&l.rowSpan||1;if(o<d.length&&d[o].renderHeight*s<i-1){if(d.defaultSize=i/s,f){var p=c._isFullEdit();return u.refresh(),void u.startEditing(p)}}else f&&n._initEditInput(N,T,null)}},0):f&&setTimeout(function(){G?n._initImeEditInput(N,T):n._initEditInput(N,T,null)},0),f){c._cellEditorVars=F.localVars;var B=function(e,t){if(u.cellEditEnding.removeHandler(B),!t.stayInEditMode){var o=wijmo.getActiveElement();o&&o.dispatchEvent(c._evtBlur),r.focus()}if(c._triggerEditorEvents(r),!t.cancel&&!t.stayInEditMode)for(var i=F.localVars,l=0,n=Object.getOwnPropertyNames(F.bindings);l<n.length;l++){var a=n[l];F.bindings[a].setValue(i,F.localVars.values[a])}var d=r.querySelectorAll(".wj-dropdown");[].forEach.call(d,function(e){var t=wijmo.Control.getControl(e);t&&wijmo.input&&t instanceof wijmo.input.DropDown&&(t.isDroppedDown=!1)})},O=function(e,t){u.cellEditEnded.removeHandler(O),c._cellEditorVars=null};u.cellEditEnding.addHandler(B),u.cellEditEnded.addHandler(O)}else this._baseCf.updateCell(e,d,s,r,l,!1)}}}y||(this._doDisposeCell(r),this._baseCf.updateCell(e,d,s,r,l))},t.prototype.getEditorValue=function(t){if(this._cellEditorVars){var o=t.editRange;return o&&o.isValid&&this._triggerEditorEvents(t.cells.getCellElement(o.row,o.col)),this._cellEditorVars.value}return e.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(e){this._doDisposeCell(e)},t.prototype._doDisposeCell=function(e){for(var o=t._templateTypes,i=0;i<o.length;i++){var r=WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType[o[i]]),l=e[r];if(l&&l.viewRef){var n=(l.column||this.grid)[r];if(n){var a=n.viewContainerRef.indexOf(l.viewRef);a>-1&&n.viewContainerRef.remove(a)}l.viewRef=null,l.rootElement=null,l.column=null,l.templateContextProperty=null,e[r]=null}}},t.prototype._setViewRefContext=function(e,t,o,i,r,l){this._needsCdCheck=!0,e.row=t,e.col=o,e.item=i;var n={},a=e.cell||{},d={},s={localVars:a,bindings:d};if(a.row=t,a.col=o,a.item=i,a.value=r,a.values=n,l)for(var p=0,c=Object.getOwnPropertyNames(l);p<c.length;p++){var u=c[p],m=new wijmo.Binding(l[u]);d[u]=m,n[u]=m.getValue(a)}return e.cell!==a&&(e.cell=a),s},t.prototype._initEditInput=function(e,o,i){var r=this;this._setFullEdit(o);var l=this._findInitialInput(e);if(l){var n=function(){l.removeEventListener("focus",n),setTimeout(function(){var e=null!=i?i:r._editChar;e&&(l.value=e,r._editChar=null,t._setSelectionRange(l,e.length,e.length),l.dispatchEvent(r._evtInput))},t._FOCUS_INTERVAL)};l.addEventListener("focus",n),l.focus()}},t.prototype._initImeEditInput=function(e,t){var o=this,i=wijmo.getActiveElement();if(i&&i instanceof HTMLInputElement&&wijmo.hasClass(i,"wj-grid-ime")){var r=function(l){i.removeEventListener("compositionend",r),wijmo.setCss(i,wijmo.grid._ImeHandler._cssHidden),o._initEditInput(e,t,i.value)};i.addEventListener("compositionend",r);var l=this._findInitialInput(e);if(l){var n=l.getBoundingClientRect(),a=i.getBoundingClientRect(),d=window.getComputedStyle(i),s=parseFloat(d.left),p=parseFloat(d.top);wijmo.setCss(i,{left:s+n.left-a.left+"px",top:p+n.top-a.top+"px",width:n.width+"px",height:n.height+"px"})}}},t.prototype._findInitialInput=function(e){var t=e&&e.rootElement&&e.rootElement.querySelectorAll("input,textarea");if(t)for(var o=0;o<t.length;o++){var i=t[o],r=window.getComputedStyle(i);if("none"!==r.display&&"visible"===r.visibility)return i}return null},t._setSelectionRange=function(e,t,o){if(void 0===o&&(o=t),wijmo.contains(document.body,e)&&!e.disabled&&"none"!=e.style.display)try{e.setSelectionRange(wijmo.asNumber(t),wijmo.asNumber(o),wijmo.isIE()?null:"backward"),e.focus()}catch(e){}},t.prototype._triggerEditorEvents=function(e){if(e)for(var t=e.querySelectorAll(".wj-control"),o=0;o<t.length;o++){var i=t[o],r=wijmo.Control.getControl(i);if(r){var l=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.getBehavior(r);l&&l.flushPendingEvents()}}},t.prototype._isFullEdit=function(){var e=this.grid;return!e.activeEditor||e._edtHdl._fullEdit},t.prototype._setFullEdit=function(e){var t=this.grid;e.forceFullEdit&&t.activeEditor&&(t._edtHdl._fullEdit=!0)},t._cellStampProp="__wjCellStamp",t._FOCUS_INTERVAL=wijmo.Control._FOCUS_INTERVAL+20,t}(wijmo.grid.CellFactory),moduleExports=[WjFlexGrid,WjFlexGridColumn,WjFlexGridCellTemplate],WjGridModule=function(){function e(){}return e=__decorate([core_1.NgModule({imports:[wijmo_angular2_directiveBase_1.WjDirectiveBaseModule,common_1.CommonModule],declarations:moduleExports.slice(),exports:moduleExports.slice()})],e)}();exports.WjGridModule=WjGridModule;